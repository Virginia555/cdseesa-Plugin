<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SPEEDTEST</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/noscript.css') }}"></noscript>
        <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}">
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    </head>
	<body class="no-sidebar is-preload">
		<div id="page-wrapper">
			<!-- Main -->
				<div class="wrapper style1">

                    <div class="container">
                        <article id="main" class="special">
                            
                            <header>
                                <h2>Test Case Results</h2>
                                {% if success|default(False) %}
                                    <p>Data correctly sent to the google sheet!</p>
                                {% endif %}
                            </header>
                            <div class="scrollable-table">
                                <table>
                                    <tr class="sticky-thead">
                                        <th>Location</th>
                                        <th>Company</th>
                                        <th>Date</th>
                                        <th>Avg Response Time (ms)</th>
                                        <th>Peak Response Time (ms)</th>
                                        <th>Error Rate (%)</th>
                                        <th>Avg Concurrency</th>
                                        <th>Peak Concurrency</th>
                                    </tr>
                                    {% for result in results %}
                                        <tr>
                                            <td>{{ result.Location }}</td>
                                            <td>{{ result.Company }}</td>
                                            <td>{{ result.Date }}</td>
                                            <td>{{ result.avgResponseTime }}</td>
                                            <td>{{ result.peakResponseTime }}</td>
                                            <td>{{ result.errorRate}}</td>
                                            <td>{{ result.avgConcurrency }}</td>
                                            <td>{{ result.peakConcurrency }}</td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                            <header>
                                <h3>Results plot</h3>
                            </header>
                            <center><img src="{{ url_for('static', filename='plots/time_series_plots.png') }}" alt="Time Series Plots"></center>
                            <div id="map", style="width: 100%; height: 750px;"></div>
                            <footer>
								<a href="/" class="button">Back to Home</a>
							</footer>
                        </article>
                    </div>
				</div>
		</div>

		<!-- Scripts -->
        <script src="{{ url_for('static', filename='js/jquery.dropotron.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.scrolly.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.scrollex.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/util.js') }}"></script>
        <script src="{{ url_for('static', filename='js/main.js') }}"></script>
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Inizializza la mappa
    var map = L.map('map').setView([42.5, 12.5], 6); // Centro iniziale della mappa Italy

    // Aggiungi un layer della mappa di OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Funzione per ottenere le coordinate dalla cittÃ  e dal paese utilizzando OpenStreetMap Nominatim
    function getCoordinates(city, callback) {
        $.getJSON('https://nominatim.openstreetmap.org/search?format=json&q=' + city, function(data) {
            if (data.length > 0) {
                var lat = data[0].lat;
                var lon = data[0].lon;
                callback(lat, lon);
            }
        });
    }

    var locationResults = {};

    function addOrUpdateMarker(location, lat, lon, content) {
        if (locationResults[location]) {
            // Update popup content and refresh the popup
            locationResults[location].popupContent += '<br><br>' + content;
            locationResults[location].marker.bindPopup(locationResults[location].popupContent);
        } else {
            // Create new marker and bind initial popup content
            var marker = L.marker([lat, lon]).addTo(map);
            marker.bindPopup(content);
            locationResults[location] = {
                marker: marker,
                popupContent: '<h1><b>'+ location + '</b></h1><br>' + content
            };
        }
    }

    // Iterate over results to populate the markers
    {% for result in results %}
        getCoordinates("{{ result.Location }}", function(lat, lon) {
            var content = "<b>{{ result.Date }}<br>Avg Response Time</b> = {{ result.avgResponseTime }}<br><b>Peak Response Time</b> = {{results.peakResponseTime}}<br><b>Error Rate</b> = {{results.errorRate}}<br><b>Avg Concurrency</b> = {{result.avgConcurrency}}<br><b>Peak Concurrency</b> = {{result.peakConcurrency}}";
            addOrUpdateMarker('{{ result.Location }}', lat, lon, content);
        });
    {% endfor %}


</script>

	</body>
</html>